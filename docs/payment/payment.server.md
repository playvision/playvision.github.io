---
title: Обработка платежных уведомлений
---

Уведомления посылаются сервером платёжной системы на Адрес обратного вызова, указанный в настройках приложения, по протоколу HTTP или HTTPS, в зависимости от протокола указанного в адресе обратного вызова, методом POST в кодировке UTF-8.

Чтобы исключить возможность подделки уведомления, уведомление подписывается секретным ключом, известным только владельцу приложения и платежной системе.


Разработчик приложения должен реализовать обработку уведомлений и вернуть либо результат обработки в случае успеха,
либо описание ошибки в случае неуспеха (см. Формат ответа в случае ошибки обработки).
При этом ответ должен быть отправлен в течение 10 секунд, иначе соединение будет разорвано, а текст ошибки будет записан в лог транзакций.

> **Внимание!** Ответ должен быть в формате **JSON** в кодировке **UTF-8**

#### Общие параметры уведомления

Параметры, указанные ниже, отправляются в уведомлении серверу приложения при каждом запросе.


|Имя           |Тип   |Примечание                                                            |
|--------------|------|----------------------------------------------------------------------|
|user_id       |Int   |ID пользователя в системе Playvision                                  |
|sid           |Int   |ID внутри игрового сервера, в случае использования нескольких серверов|
|transaction_id|Int   |Идентификатор заказа                                                  |
|sum           |Int   |Количество игровой валюты                                             |
|bonus         |Int   |Количество бонусной игровой валюты                                    |
|time          |Int   |Время в формате timestamp                                             |
|sig           |String|подпись уведомления (см. [Генерация подписи](/docs/))                 |

#### Проверка подписи уведомления

Параметр sig равен md5 от конкатенации пар имя параметров=значение параметра, расположенных в порядке возрастания имени параметра (по алфавиту) и секретный ключ проекта, указанной в настройках Вашего приложения.

![секретный ключ проекта](/images/payment/scr1.jpg "секретный ключ проекта")

При несовпадении подписей необходимо выдать в ответе ошибку.

Пример формирования подписи с секретным ключом SeOkPegfgFDS2:

> sig = md5("name1=value1name2=valueSeOkPegfgFDS2")


#### Уведомление платформы Playvision о результате платежа

После обработки информации о зачислении средств пользователю необходимо отослать уведомление платформе Playvision о результате выполнения.
Ответ должен быть в формате json и содержать следующие поля:

|Имя    |Тип      |Примечание                                                                                         |
|-------|---------|---------------------------------------------------------------------------------------------------|
|status |Int      |Статус выполнения заказа. Успешный - 1, Неуспешный - остальные числа                               |
|message|String   |Строка об ошибке, в случае неудачного платежа, будет отображена в логе транзакций(поле "Результат")|



**Примеры ответа**

Успешный платеж:

> {"status": "1"}

Неудачный платеж:

> {"status": "-1", "message": "Невалидная сигнатура"}

[**<- Вернуться к основной документации**](/docs/payment/)
